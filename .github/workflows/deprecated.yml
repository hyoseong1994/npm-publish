name: Deprecation ⚠️

on:
  workflow_dispatch:
    inputs:
      version:
        description: "deprecated 할 버전 (예: 1.2.3)"
        required: true
        type: string
      reason:
        description: "deprecation 사유"
        required: true
        type: string

jobs:
  deprecated:
    runs-on: ubuntu-latest
    steps:
      - name: Validate version format
        run: |
          VERSION="${{ inputs.version }}"
          if [[ ! "$VERSION" =~ ^[0-9]+\.[0-9]+\.[0-9]+$ ]]; then
            echo "❌ Invalid version format: $VERSION"
            echo "Version must be in format: X.Y.Z (e.g., 1.2.3)"
            exit 1
          fi

      - uses: actions/checkout@v6
      - uses: oven-sh/setup-bun@v2
        with:
          registry-url: https://registry.npmjs.org
      - name: Deprecate npm package version
        env:
          NPM_TOKEN: ${{ secrets.NPM_TOKEN }}
        run: |
          PACKAGE_NAME=$(jq -r .name package.json)
          npm deprecate "$PACKAGE_NAME@${{ inputs.version }}" "${{ inputs.reason }}"
